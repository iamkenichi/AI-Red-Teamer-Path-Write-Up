import json, requests
from pathlib import Path

TARGET_IP = "10.129.59.232"
UPLOAD_URL = f"http://{TARGET_IP}:8002/api/upload"
MODEL_FILE = "malware_classifier.pth"

p = Path(MODEL_FILE)
print("[i] Model file:", p.resolve(), "| exists:", p.exists(), "| size:", p.stat().st_size if p.exists() else "N/A")
print("[i] Upload URL:", UPLOAD_URL)

try:
    with open(p, "rb") as f:
        files = {"model": ("malware_classifier.pth", f, "application/octet-stream")}
        r = requests.post(UPLOAD_URL, files=files, timeout=180)

    print("[i] HTTP:", r.status_code)
    print("[i] Headers:", dict(r.headers))
    try:
        print(json.dumps(r.json(), indent=4))
    except Exception:
        print(r.text[:3000])

except requests.exceptions.ConnectTimeout:
    print("[!] Connect timeout. Target not reachable on port 8002 from your machine/VPN route.")
except requests.exceptions.ConnectionError as e:
    print("[!] Connection error (cannot reach server/port). Details:\n", e)
except Exception as e:
    print("[!] Unexpected error:\n", e)
